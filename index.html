<html>

<!-- <body onload="initializeVariables()"> -->
<body  onload="init()">
 <button onclick="getPlayLists()">Listar playlists</button> 
 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script>

function init() {
const hash = window.location.hash
.substring(1)
.split('&')
.reduce(function (initial, item) {
  if (item) {
    var parts = item.split('=');
    initial[parts[0]] = decodeURIComponent(parts[1]);
  }
  return initial;
}, {});
window.location.hash = '';

// Set token
let _token = hash.access_token;
this._accessToken = hash.access_token;

const authEndpoint = 'https://accounts.spotify.com/authorize';


const clientId = '52f9e97b6df9462c9f239085ffb73145';
const redirectUri = 'https://jojeda10.github.io';
const scopes = [
  'user-top-read'
];

if (!_token) {
  window.location = `${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join('%20')}&response_type=token&show_dialog=true`;
}
}

function initializeVariables() {
 this._client_id = '52f9e97b6df9462c9f239085ffb73145';
  this._client_secret = 'c6b9a2ca5d204d7983d4377566f9d8bf';
}

function getPlayLists() {
  $.ajax({
    url: 'https://api.spotify.com/v1/me/playlists ',
    headers: {
      'Authorization': 'Bearer ' + this._accessToken
    },
    success: function(response) {
	 drawPlayListsTable(response.items);
    }
  });
}

function displayTracks(playlist) {
  this._playListId = playlist.currentTarget.id;
  $.ajax({
    url: 'https://api.spotify.com/v1/playlists/' + playlist.currentTarget.id + '/tracks ',
    headers: {
      'Authorization': 'Bearer ' + playlist.currentTarget.token
    },
	success: jQuery.proxy(function(response) {
     drawTracksTable(response.items, this._playListId);
	}, this),
  });
}

function removeTrack(track) {


   var params = {
    "tracks": [
        {
            "uri": track.currentTarget.uri,
            "positions": [0]
        }
    ]
}


  $.ajax({
    url: 'https://api.spotify.com/v1/playlists/' + track.currentTarget.id + '/tracks',
	type: 'DELETE',
	data: params,
    headers: {
      'Authorization': 'Bearer ' + track.currentTarget.token
	  'Content-Type': 'application/json'
    },
    success: function(response) {
	debugger;
    }
  });
};




function drawPlayListsTable(PlayLists) {

    PlayLists.map( function(list) {
  var body = document.getElementsByTagName("body")[0];
  var table   = document.createElement("table");
  var tblBody = document.createElement("tbody");

  for (var i = 0; i < PlayLists.length; i++) {
    var row = document.createElement("tr");

      var cell1 = document.createElement("td");
      var cellText = document.createTextNode(PlayLists[i].name);
      cell1.appendChild(cellText);
      row.appendChild(cell1);
	  var button   = document.createElement("button");
	  button.id = PlayLists[i].id;
	  button.token = this._accessToken;
	  button.onclick = displayTracks;
	  var buttonText = document.createTextNode("Display Songs");
	  button.appendChild(buttonText);
	  var cell2 = document.createElement("td");
      cell2.appendChild(button);
      row.appendChild(cell2);
    tblBody.appendChild(row);
  }
 
  table.appendChild(tblBody);
  body.appendChild(table);
  table.setAttribute("border", "2");  
  
    });
}

function drawTracksTable(Tracks, PlayListId) {

  //  Tracks.map( function(list) {
  var body = document.getElementsByTagName("body")[0];
  var table   = document.createElement("table");
  var tblBody = document.createElement("tbody");

  for (var i = 0; i < Tracks.length; i++) {
    var row = document.createElement("tr");

      var cell1 = document.createElement("td");
      var cellText = document.createTextNode(Tracks[i].track.name);
      cell1.appendChild(cellText);
      row.appendChild(cell1);
	  var button   = document.createElement("button");
	  button.id = PlayListId;
	  button.token = this._accessToken;
	  button.uri = Tracks[i].track.uri;
	  button.onclick = removeTrack;
	  var buttonText = document.createTextNode("Remove");
	  button.appendChild(buttonText);
	  var cell2 = document.createElement("td");
      cell2.appendChild(button);
      row.appendChild(cell2);
    tblBody.appendChild(row);
  }
 
  table.appendChild(tblBody);
  body.appendChild(table);
  table.setAttribute("border", "2");  
  
 //   });
}





</script>
</body>
</html>
